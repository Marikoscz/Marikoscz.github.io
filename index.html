 <!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Nftables Configuration Guide</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main>
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="site-header">
                    <h1 class="site-title">Nftables Guide</h1>
                    <p class="site-tagline">Advanced Firewall Configuration</p>
                </div>

                <hr class="separator">

                <div class="toc-box">
                    <h4>ğŸ“‘ Obsah dokumentace</h4>
                    <ul>
                        <li><a href="#overview">ğŸ¯ CÃ­l projektu</a></li>
                        <li><a href="#differences">âš–ï¸ RozdÃ­ly Nftables vs Iptables</a></li>
                        <li><a href="#testbed">ğŸ”¬ TestovacÃ­ prostÅ™edÃ­</a></li>
                        <li><a href="#rule-binding">ğŸ”— Vazba pravidel</a></li>
                        <li><a href="#counters">ğŸ“Š PoÄÃ­tadla</a></li>
                        <li><a href="#nat">ğŸŒ NAT konfigurace</a>
                            <ul>
                                <li><a href="#snat">â†—ï¸ SNAT</a></li>
                                <li><a href="#dnat">â†™ï¸ DNAT</a></li>
                            </ul>
                        </li>
                        <li><a href="#rulesets">ğŸ—‚ï¸ Sady pravidel</a></li>
                        <li><a href="#maps">ğŸ—ºï¸ Mapy</a></li>
                    </ul>
                </div>

                <div class="info-box">
                    <h5>ğŸ›¡ï¸ BezpeÄnostnÃ­ info</h5>
                    <p><strong>Nftables</strong> je souÄÃ¡stÃ­ linuxovÃ©ho jÃ¡dra od verze 3.13 a plnÄ› nahrazuje iptables od Debian 10+</p>
                    <p>âš ï¸ VÅ¾dy testujte pravidla v izolovanÃ©m prostÅ™edÃ­ pÅ™ed nasazenÃ­m do produkce</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="content">
            <!-- Overview Section -->
            <section id="overview" class="section highlight">
                <h2>ğŸ¯ CÃ­l projektu</h2>
                <p>Implementovat pokroÄilou konfiguraci firewallu pomocÃ­ <strong>nftables</strong> s dÅ¯razem na praktickÃ© pÅ™Ã­klady modernÃ­ch technik jako jsou vazby pravidel, poÄÃ­tadla, NAT, strukturovanÃ© sady pravidel a mapy pro efektivnÃ­ sprÃ¡vu sÃ­Å¥ovÃ©ho provozu.</p>
            </section>

            <!-- Differences Section -->
            <section id="differences" class="section">
                <h2>âš–ï¸ RozdÃ­ly mezi Nftables a Iptables</h2>
                <p>Nftables je modernÃ­ nÃ¡hrada za iptables, kterÃ¡ pÅ™inÃ¡Å¡Ã­ jednotnÃ© rozhranÃ­ pro IPv4, IPv6, ARP a bridge filtering; oproti iptables pouÅ¾Ã­vÃ¡ novÃ¡ syntaxi zaloÅ¾enou na tabulkÃ¡ch a Å™etÄ›zcÃ­ch bez pÅ™edem definovanÃ© struktury, nabÃ­zÃ­ lepÅ¡Ã­ vÃ½kon dÃ­ky optimalizovanÃ©mu kernel subsystÃ©mu, podporuje dynamickÃ© aktualizace pravidel bez nutnosti pÅ™episovat celou sadu, zavÃ¡dÃ­ pokroÄilÃ© struktury jako mapy a sety pro efektivnÃ­ vyhledÃ¡vÃ¡nÃ­ a umoÅ¾Åˆuje atomickÃ© operace nad pravidly.</p>
                <ul>
                    <li><strong>âœ“ JednotnÃ¡ syntaxe</strong> pro vÅ¡echny typy filtrovÃ¡nÃ­ (IPv4, IPv6, ARP, bridge)</li>
                    <li><strong>âœ“ LepÅ¡Ã­ vÃ½kon</strong> dÃ­ky optimalizovanÃ©mu jÃ¡drovÃ©mu subsystÃ©mu</li>
                    <li><strong>âœ“ FlexibilnÄ›jÅ¡Ã­ struktura</strong> - volitelnÃ© tabulky a Å™etÄ›zce</li>
                    <li><strong>âœ“ AtomickÃ© operace</strong> - pravidla lze aktualizovat bez pÅ™eruÅ¡enÃ­</li>
                    <li><strong>âœ“ NativnÃ­ podpora setÅ¯ a map</strong> - efektivnÄ›jÅ¡Ã­ vyhledÃ¡vÃ¡nÃ­</li>
                </ul>
            </section>

            <!-- Testbed Section -->
            <section id="testbed" class="section">
                <h2>ğŸ”¬ TestovacÃ­ prostÅ™edÃ­</h2>
                <p>Pro praktickÃ© testovÃ¡nÃ­ nftables je vhodnÃ© vytvoÅ™it izolovanÃ© prostÅ™edÃ­ s minimÃ¡lnÄ› dvÄ›ma virtuÃ¡lnÃ­mi stroji nebo kontejnery propojenÃ½mi pÅ™es sÃ­Å¥ovÃ½ bridge, pÅ™iÄemÅ¾ jeden stroj funguje jako router/firewall s nftables a druhÃ½ jako klient; vhodnÃ© nÃ¡stroje zahrnujÃ­ VirtualBox, QEMU/KVM, LXC/LXD nebo Docker.</p>
                <ul>
                    <li>ğŸ–¥ï¸ VirtualBox / QEMU/KVM - virtuÃ¡lnÃ­ stroje s linuxem</li>
                    <li>ğŸ“¦ Docker / LXC - lehkÃ© kontejnery</li>
                    <li>ğŸ”€ Network namespace - izolovanÃ© sÃ­Å¥ovÃ© prostÅ™edÃ­ v jednom systÃ©mu</li>
                    <li>ğŸŒ GNS3 / EVE-NG - pokroÄilÃ© sÃ­Å¥ovÃ© simulace</li>
                </ul>
                <details>
                    <summary>ğŸ“ PÅ™Ã­klad topologie</summary>
                    <pre><code>Klient (192.168.1.10) &lt;--&gt; Router/Firewall (192.168.1.1 / 10.0.0.1) &lt;--&gt; Server (10.0.0.10)</code></pre>
                </details>
            </section>

            <!-- Rule Binding Section -->
            <section id="rule-binding" class="section">
                <h2>ğŸ”— Vazba pravidel (Rule Binding)</h2>
                <p>Vazba pravidel v nftables umoÅ¾Åˆuje dynamickÃ© pÅ™iÅ™azovÃ¡nÃ­ pravidel k rozhranÃ­m nebo sadÃ¡m objektÅ¯ pomocÃ­ symbolickÃ½ch promÄ›nnÃ½ch, coÅ¾ zjednoduÅ¡uje sprÃ¡vu a umoÅ¾Åˆuje flexibilnÃ­ aplikaci politik bez nutnosti duplikace pravidel pro kaÅ¾dÃ© rozhranÃ­ zvlÃ¡Å¡Å¥.</p>
                <details>
                    <summary>ğŸ’» PÅ™Ã­klad vazby na rozhranÃ­</summary>
                    <pre><code>table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;
        iifname "lo" accept
        iifname "eth0" tcp dport 22 accept
        ct state established,related accept
    }
}</code></pre>
                </details>
                <details>
                    <summary>ğŸ’» PÅ™Ã­klad s definicÃ­ promÄ›nnÃ©</summary>
                    <pre><code>define WAN_IF = eth0
define LAN_IF = eth1

table inet filter {
    chain forward {
        type filter hook forward priority 0; policy drop;
        iifname $LAN_IF oifname $WAN_IF accept
        iifname $WAN_IF oifname $LAN_IF ct state related,established accept
    }
}</code></pre>
                </details>
            </section>

            <!-- Counters Section -->
            <section id="counters" class="section">
                <h2>ğŸ“Š PoÄÃ­tadla (Counters)</h2>
                <p>PoÄÃ­tadla v nftables slouÅ¾Ã­ ke sledovÃ¡nÃ­ poÄtu paketÅ¯ a bajtÅ¯, kterÃ© projdou danÃ½m pravidlem; lze je pÅ™idat ke kterÃ©mukoliv pravidlu pomocÃ­ klÃ­ÄovÃ©ho slova 'counter' a zobrazit pÅ™Ã­kazem 'nft list ruleset' nebo resetovat pomocÃ­ 'nft reset counters'.</p>
                <details>
                    <summary>ğŸ’» ZÃ¡kladnÃ­ pouÅ¾itÃ­ poÄÃ­tadla</summary>
                    <pre><code>table inet filter {
    chain input {
        type filter hook input priority 0;
        tcp dport 80 counter accept
        tcp dport 443 counter accept
    }
}</code></pre>
                </details>
                <details>
                    <summary>ğŸ’» PojmenovanÃ¡ poÄÃ­tadla</summary>
                    <pre><code>table inet filter {
    counter http_traffic {
        packets 0 bytes 0
    }
    
    chain input {
        type filter hook input priority 0;
        tcp dport { 80, 8080 } counter name http_traffic accept
    }
}</code></pre>
                </details>
                <p style="color: #b8c5ff; font-size: 0.95rem; margin-top: 1.5rem;"><strong>ğŸ“ˆ ZobrazenÃ­ statistik:</strong> <span class="inline-code">nft list ruleset | grep counter</span></p>
            </section>

            <!-- NAT Section -->
            <section id="nat" class="section">
                <h2>ğŸŒ NAT konfigurace</h2>
                <p>Network Address Translation (NAT) v nftables umoÅ¾Åˆuje pÅ™eklad sÃ­Å¥ovÃ½ch adres pro smÄ›rovÃ¡nÃ­ provozu mezi rÅ¯znÃ½mi sÃ­tÄ›mi; SNAT (Source NAT) mÄ›nÃ­ zdrojovou IP adresu odchozÃ­ch paketÅ¯, typicky pÅ™i pÅ™ipojenÃ­ privÃ¡tnÃ­ sÃ­tÄ› k internetu, zatÃ­mco DNAT (Destination NAT) upravuje cÃ­lovou adresu pro pÅ™esmÄ›rovÃ¡nÃ­ pÅ™Ã­chozÃ­ch spojenÃ­ na konkrÃ©tnÃ­ internÃ­ servery.</p>
                
                <h3 id="snat">â†—ï¸ SNAT - Source NAT (Masquerading)</h3>
                <details>
                    <summary>ğŸ’» SNAT s masquerade</summary>
                    <pre><code>table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100;
        oifname "eth0" masquerade
    }
}</code></pre>
                </details>
                <details>
                    <summary>ğŸ’» SNAT se statickou IP</summary>
                    <pre><code>table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100;
        oifname "eth0" snat to 203.0.113.5
    }
}</code></pre>
                </details>

                <h3 id="dnat">â†™ï¸ DNAT - Destination NAT (Port Forwarding)</h3>
                <details>
                    <summary>ğŸ’» DNAT - pÅ™esmÄ›rovÃ¡nÃ­ portu</summary>
                    <pre><code>table ip nat {
    chain prerouting {
        type nat hook prerouting priority -100;
        iifname "eth0" tcp dport 80 dnat to 192.168.1.100:80
        iifname "eth0" tcp dport 443 dnat to 192.168.1.100:443
    }
}</code></pre>
                </details>
                <details>
                    <summary>ğŸ’» DNAT s rozsahem portÅ¯</summary>
                    <pre><code>table ip nat {
    chain prerouting {
        type nat hook prerouting priority -100;
        iifname "eth0" tcp dport 8000-8100 dnat to 192.168.1.50
    }
}</code></pre>
                </details>
            </section>

            <!-- Rulesets Section -->
            <section id="rulesets" class="section">
                <h2>ğŸ—‚ï¸ Sady pravidel a struktury</h2>
                <p>Nftables organizuje pravidla do hierarchickÃ© struktury sklÃ¡dajÃ­cÃ­ se z tabulek (tables), Å™etÄ›zcÅ¯ (chains) a pravidel (rules); kaÅ¾dÃ¡ tabulka nÃ¡leÅ¾Ã­ do rodiny protokolÅ¯ (ip, ip6, inet, arp, bridge, netdev) a obsahuje Å™etÄ›zce, kterÃ© se navÄ›Å¡ujÃ­ na specifickÃ© hooky v sÃ­Å¥ovÃ©m zÃ¡sobnÃ­ku (prerouting, input, forward, output, postrouting) s definovanou prioritou.</p>
                <ul>
                    <li><strong>ğŸ“‹ Tabulky</strong> (tables) - kontejnery pro Å™etÄ›zce
                        <ul>
                            <li>ip, ip6, inet, arp, bridge, netdev</li>
                        </ul>
                    </li>
                    <li><strong>â›“ï¸ Å˜etÄ›zce</strong> (chains) - sekvence pravidel
                        <ul>
                            <li>Base chains: pÅ™ipojeny k hookÅ¯ (input, output, forward...)</li>
                            <li>Regular chains: volÃ¡ny z jinÃ½ch Å™etÄ›zcÅ¯</li>
                        </ul>
                    </li>
                    <li><strong>ğŸ“ Pravidla</strong> (rules) - akce provÃ¡dÄ›nÃ© na pakety</li>
                </ul>
                <details>
                    <summary>ğŸ’» KomplexnÃ­ struktura</summary>
                    <pre><code>table inet firewall {
    # PomocnÃ½ Å™etÄ›zec
    chain allow_ssh {
        ip saddr 192.168.1.0/24 accept
        log prefix "SSH denied: " drop
    }
    
    chain input {
        type filter hook input priority 0; policy drop;
        
        # ZÃ¡kladnÃ­ pravidla
        ct state invalid drop
        ct state established,related accept
        iifname "lo" accept
        
        # VolÃ¡nÃ­ pomocnÃ©ho Å™etÄ›zce
        tcp dport 22 jump allow_ssh
        
        # ICMP
        ip protocol icmp accept
        ip6 nexthdr icmpv6 accept
    }
    
    chain forward {
        type filter hook forward priority 0; policy drop;
        ct state established,related accept
    }
    
    chain output {
        type filter hook output priority 0; policy accept;
    }
}</code></pre>
                </details>
            </section>

            <!-- Maps Section -->
            <section id="maps" class="section">
                <h2>ğŸ—ºï¸ Mapy (Maps)</h2>
                <p>Mapy v nftables jsou pokroÄilÃ© datovÃ© struktury typu klÃ­Ä-hodnota, kterÃ© umoÅ¾ÅˆujÃ­ efektivnÃ­ vyhledÃ¡vÃ¡nÃ­ a aplikaci rÅ¯znÃ½ch akcÃ­ nebo hodnot na zÃ¡kladÄ› shody s klÃ­Äem; lze je pouÅ¾Ã­t napÅ™Ã­klad pro NAT pÅ™eklady podle portÅ¯, smÄ›rovÃ¡nÃ­ do rÅ¯znÃ½ch Å™etÄ›zcÅ¯ podle IP adres nebo dynamickÃ© nastavenÃ­ limitÅ¯, ÄÃ­mÅ¾ znaÄnÄ› zjednoduÅ¡ujÃ­ sprÃ¡vu komplexnÃ­ch pravidel.</p>
                <details>
                    <summary>ğŸ’» Mapa pro DNAT podle portu</summary>
                    <pre><code>table ip nat {
    map portmap {
        type inet_service : ipv4_addr
        elements = {
            80 : 192.168.1.10,
            443 : 192.168.1.10,
            22 : 192.168.1.20,
            3306 : 192.168.1.30
        }
    }
    
    chain prerouting {
        type nat hook prerouting priority -100;
        dnat to tcp dport map @portmap
    }
}</code></pre>
                </details>
                <details>
                    <summary>ğŸ’» Mapa pro smÄ›rovÃ¡nÃ­ do Å™etÄ›zcÅ¯</summary>
                    <pre><code>table inet filter {
    chain web_traffic {
        log prefix "WEB: " accept
    }
    
    chain ssh_traffic {
        limit rate 5/minute log prefix "SSH: "
        accept
    }
    
    map service_map {
        type inet_service : verdict
        elements = {
            22 : jump ssh_traffic,
            80 : jump web_traffic,
            443 : jump web_traffic
        }
    }
    
    chain input {
        type filter hook input priority 0; policy drop;
        ct state established,related accept
        tcp dport vmap @service_map
    }
}</code></pre>
                </details>
                <details>
                    <summary>ğŸ’» Sety a anonymnÃ­ mapy</summary>
                    <pre><code>table inet filter {
    set allowed_ips {
        type ipv4_addr
        flags interval
        elements = { 192.168.1.0/24, 10.0.0.0/8 }
    }
    
    chain input {
        type filter hook input priority 0; policy drop;
        ip saddr @allowed_ips tcp dport 22 accept
        
        # AnonymnÃ­ mapa pro rate limiting
        tcp dport { 80, 443 } limit rate over 100 mbytes/second drop
    }
}</code></pre>
                </details>
                <p style="color: #b8c5ff; font-size: 0.95rem; line-height: 1.8; margin-top: 1.5rem;">
                    <strong>â• PÅ™idÃ¡nÃ­ prvku do mapy:</strong> <span class="inline-code">nft add element inet filter allowed_ips { 172.16.0.0/12 }</span><br>
                    <strong>ğŸ“‹ ZobrazenÃ­ mapy:</strong> <span class="inline-code">nft list map inet nat portmap</span>
                </p>
            </section>

            <hr class="separator">

            <div class="footer">
                ğŸ”’ Advanced Nftables Configuration Guide | Dokumentace vytvoÅ™ena pro ÃºÄely sÃ­Å¥ovÃ© bezpeÄnosti
            </div>
        </div>
    </main>

    <script src="script.js"></script>
</body>
</html> 
